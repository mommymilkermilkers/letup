(function(a,s,g,d){"use strict";function b(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}function l(t){return t&&typeof t.length=="number"?t.length>0:t||t===0||t===!1}function h(t){return JSON.parse(JSON.stringify(t,function(n,e){if(e===t)return e;if(!(typeof n=="string"&&n.startsWith("_")))switch(typeof e){case"object":{if(Array.isArray(e)&&e.length===0)return;const r=Object.entries(e).filter(function(A){return l(A[1])});return r.length>0?Object.fromEntries(r):void 0}default:return l(e)?e:void 0}}))}var y=function(t){return t[t.PLAYING=0]="PLAYING",t[t.STREAMING=1]="STREAMING",t[t.LISTENING=2]="LISTENING",t[t.WATCHING=3]="WATCHING",t[t.COMPETING=5]="COMPETING",t}(y||{});const u=g.findByProps("getAssetIds"),c=Date.now(),i=s.plugin.storage;typeof i.selected?.length!="number"&&Object.assign(i,{selected:"default",selections:{default:I()}});function I(){return{name:"Discord",application_id:"1054951789318909972",flags:0,type:0,timestamps:{_enabled:!1,start:c},assets:{},buttons:[{},{}]}}async function f(t){if(typeof t!="object")throw new Error("Invalid activity");if(t){const n=t?.timestamps?._enabled;if(t=h(t),n?t.timestamps.start||=c:delete t.timestamps,t.assets){const e=[t.application_id,[t.assets.large_image,t.assets.small_image]];let r=u.getAssetIds(...e);r.length||(r=await u.fetchAssetIds(...e)),t.assets.large_image=r[0],t.assets.small_image=r[1]}t.buttons?.length?(t.buttons=t.buttons.filter(function(e){return e.label&&e.url}),t.buttons.length?Object.assign(t,{metadata:{button_urls:t.buttons.map(function(e){return e.url})},buttons:t.buttons.map(function(e){return e.label})}):delete t.buttons):delete t.buttons}return d.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:t,pid:1608,socketId:"RichPresence@Vendetta"}),t}var p=new(function(){function t(){b(this,t)}return m(t,[{key:"onLoad",value:function(){s.logger.log("Sending RPC request");const n=i.selections[i.selected];if(!n)throw new Error("Selected activity does not exist");f(n).then(function(e){s.logger.log("RPC request sent"),s.logger.log(e)}).catch(function(e){s.logger.error("An error occured while sending RPC request :("),s.logger.error(e?.stack??e)})}},{key:"onUnload",value:function(){s.logger.log("Stopping RPC request"),f(null)}}]),t}());return a.default=p,Object.defineProperty(a,"__esModule",{value:!0}),a})({},vendetta,vendetta.metro,vendetta.metro.common);
